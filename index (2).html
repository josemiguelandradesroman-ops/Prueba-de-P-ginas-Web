<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Proyectos</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para compilar JSX en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configuración de Tailwind para animaciones y fuentes -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'fade-in-up': 'fadeInUp 0.4s ease-out',
                        'scale-up': 'scaleUp 0.2s ease-out',
                        'scale-in': 'scaleIn 0.15s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        scaleUp: {
                            '0%': { opacity: '0', transform: 'scale(0.95)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        },
                        scaleIn: {
                            '0%': { opacity: '0', transform: 'scale(0.9)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        body { background-color: #f5f5f7; color: #1d1d1f; }
        /* Blur backdrop for modals */
        .backdrop-blur-xl { backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONOS (SVG Components) ---
        const IconWrapper = ({ children, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Folder = (p) => <IconWrapper {...p}><path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 2H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/></IconWrapper>;
        const Plus = (p) => <IconWrapper {...p}><path d="M5 12h14"/><path d="M12 5v14"/></IconWrapper>;
        const FileText = (p) => <IconWrapper {...p}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></IconWrapper>;
        const ArrowLeft = (p) => <IconWrapper {...p}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></IconWrapper>;
        const UploadCloud = (p) => <IconWrapper {...p}><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m16 16-4-4-4 4"/></IconWrapper>;
        const MoreHorizontal = (p) => <IconWrapper {...p}><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></IconWrapper>;
        const Search = (p) => <IconWrapper {...p}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconWrapper>;
        const GridIcon = (p) => <IconWrapper {...p}><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></IconWrapper>;
        const ListIcon = (p) => <IconWrapper {...p}><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></IconWrapper>;
        const XIcon = (p) => <IconWrapper {...p}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconWrapper>;
        const Check = (p) => <IconWrapper {...p}><polyline points="20 6 9 17 4 12"/></IconWrapper>;
        const Settings = (p) => <IconWrapper {...p}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></IconWrapper>;
        const Edit2 = (p) => <IconWrapper {...p}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></IconWrapper>;
        const ImageIcon = (p) => <IconWrapper {...p}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></IconWrapper>;
        const Trash2 = (p) => <IconWrapper {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></IconWrapper>;
        const User = (p) => <IconWrapper {...p}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconWrapper>;
        const CalendarIcon = (p) => <IconWrapper {...p}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></IconWrapper>;
        const ChevronLeft = (p) => <IconWrapper {...p}><path d="m15 18-6-6 6-6"/></IconWrapper>;
        const ChevronRight = (p) => <IconWrapper {...p}><path d="m9 18 6-6-6-6"/></IconWrapper>;
        const CheckSquare = (p) => <IconWrapper {...p}><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></IconWrapper>;
        const Clock = (p) => <IconWrapper {...p}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconWrapper>;
        const CalendarDays = (p) => <IconWrapper {...p}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></IconWrapper>;
        const LayoutGrid = (p) => <IconWrapper {...p}><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></IconWrapper>;
        const Eye = (p) => <IconWrapper {...p}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></IconWrapper>;
        const Download = (p) => <IconWrapper {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></IconWrapper>;

        // --- UTILIDADES ---
        const daysOfWeek = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
        const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
        const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
        const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();

        // --- DATOS INICIALES ---
        const initialProjects = [
            { 
                id: 1, title: 'Lanzamiento Q4', category: 'Marketing', color: 'bg-blue-500', textColor: 'text-blue-500', icon: null,
                files: [{ id: 101, name: 'Demo_Imagen.png', size: '2.4 MB', type: 'PNG', date: 'Hace 2 horas', icon: null, content: null }],
                tasks: [{ id: 1, text: 'Reunión inicial', date: new Date().toISOString().split('T')[0], completed: true }]
            },
            { 
                id: 2, title: 'Rediseño Web', category: 'Desarrollo', color: 'bg-indigo-500', textColor: 'text-indigo-500', icon: null,
                files: [],
                tasks: []
            },
        ];

        // --- COMPONENTE PRINCIPAL ---
        const App = () => {
            // Estado y Persistencia
            const [currentView, setCurrentView] = useState('dashboard');
            const [dashboardView, setDashboardView] = useState('grid');
            const [activeProject, setActiveProject] = useState(null);
            const [activeTab, setActiveTab] = useState('files');
            const [searchQuery, setSearchQuery] = useState('');
            
            const [projects, setProjects] = useState(() => {
                const saved = localStorage.getItem('appleProjects_v2');
                return saved ? JSON.parse(saved) : initialProjects;
            });

            const [userProfile, setUserProfile] = useState(() => {
                const saved = localStorage.getItem('appleUserProfile');
                return saved ? JSON.parse(saved) : { name: 'Usuario', avatar: null };
            });

            // Guardar en LocalStorage con manejo de errores (QuotaExceeded)
            useEffect(() => { 
                try {
                    localStorage.setItem('appleProjects_v2', JSON.stringify(projects)); 
                } catch (e) {
                    console.error("Storage full", e);
                    alert("Almacenamiento lleno. Algunos archivos grandes no se guardarán permanentemente.");
                }
            }, [projects]);
            useEffect(() => { localStorage.setItem('appleUserProfile', JSON.stringify(userProfile)); }, [userProfile]);

            // Modales
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [isSettingsModalOpen, setIsSettingsModalOpen] = useState(false);
            const [isProfileModalOpen, setIsProfileModalOpen] = useState(false);
            const [editingFileId, setEditingFileId] = useState(null);
            const [previewFile, setPreviewFile] = useState(null); // Estado para la previsualización

            // Helpers Calendario Global
            const getAllTasks = () => projects.flatMap(p => p.tasks.map(t => ({...t, projectId: p.id, projectTitle: p.title, projectColor: p.color, projectTextColor: p.textColor})));
            const handleGlobalAddTask = (text, date, projectId) => {
                const updatedProjects = projects.map(p => p.id === parseInt(projectId) ? { ...p, tasks: [...p.tasks, { id: Date.now(), text, date, completed: false }] } : p);
                setProjects(updatedProjects);
            };
            const handleGlobalToggleTask = (taskId) => {
                const updatedProjects = projects.map(p => ({ ...p, tasks: p.tasks.map(t => t.id === taskId ? { ...t, completed: !t.completed } : t) }));
                setProjects(updatedProjects);
            };
            const handleGlobalDeleteTask = (taskId) => {
                const updatedProjects = projects.map(p => ({ ...p, tasks: p.tasks.filter(t => t.id !== taskId) }));
                setProjects(updatedProjects);
            };

            // Navegación
            const handleOpenProject = (project) => { setActiveProject(project); setCurrentView('project-detail'); setActiveTab('files'); };
            const handleBackToDashboard = () => { setActiveProject(null); setCurrentView('dashboard'); setIsSettingsModalOpen(false); };
            const handleUpdateProfile = (newName, newAvatar) => { setUserProfile({ name: newName, avatar: newAvatar || userProfile.avatar }); setIsProfileModalOpen(false); };

            // CRUD Proyectos
            const handleCreateProject = (title, category, iconDataUrl) => {
                let color = 'bg-gray-500'; let textColor = 'text-gray-500';
                if(category === 'Marketing') { color = 'bg-blue-500'; textColor = 'text-blue-500'; }
                if(category === 'Desarrollo') { color = 'bg-indigo-500'; textColor = 'text-indigo-500'; }
                if(category === 'Finanzas') { color = 'bg-green-500'; textColor = 'text-green-500'; }
                const newProject = { id: Date.now(), title, category, color, textColor, icon: iconDataUrl, files: [], tasks: [] };
                setProjects([...projects, newProject]); setIsModalOpen(false);
            };
            const handleUpdateProject = (projectId, newTitle, newIconDataUrl) => {
                const updatedProjects = projects.map(p => p.id === projectId ? { ...p, title: newTitle, icon: newIconDataUrl !== undefined ? newIconDataUrl : p.icon } : p);
                setProjects(updatedProjects); setActiveProject(updatedProjects.find(p => p.id === projectId)); setIsSettingsModalOpen(false);
            };

            // CRUD Archivos (Actualizado para leer contenido)
            const handleUploadFile = (file) => {
                if (!activeProject) return;

                const addFileToState = (fileContent = null) => {
                    const isFileObject = file instanceof File;
                    const fileName = isFileObject ? file.name : file;
                    const fileSize = isFileObject ? (file.size / (1024 * 1024)).toFixed(2) + ' MB' : '0.5 MB';
                    const fileType = fileName.split('.').pop().toUpperCase();
                    
                    const newFile = {
                        id: Date.now(),
                        name: fileName,
                        size: fileSize,
                        type: fileType,
                        date: 'Justo ahora',
                        icon: null,
                        content: fileContent // Guardamos el contenido real
                    };

                    const updatedProjects = projects.map(p => p.id === activeProject.id ? { ...p, files: [...p.files, newFile] } : p);
                    setProjects(updatedProjects); 
                    setActiveProject(updatedProjects.find(p => p.id === activeProject.id));
                };

                if (file instanceof File) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        // Limite de seguridad simple para localStorage (si es muy grande, no guardamos content para evitar crash inmediato)
                        // Para este demo, intentamos guardar todo, el try/catch del useEffect manejará el error de cuota.
                        addFileToState(reader.result);
                    };
                    reader.readAsDataURL(file);
                } else {
                    addFileToState(null); // Archivo simulado
                }
            };

            const handleRenameFile = (fileId, newName) => {
                const updatedProjects = projects.map(p => p.id === activeProject.id ? { ...p, files: p.files.map(f => f.id === fileId ? { ...f, name: newName } : f) } : p);
                setProjects(updatedProjects); setActiveProject(updatedProjects.find(p => p.id === activeProject.id)); setEditingFileId(null);
            };
            const handleChangeFileIcon = (fileId, iconFile) => {
                const reader = new FileReader();
                reader.onloadend = () => {
                    const updatedProjects = projects.map(p => p.id === activeProject.id ? { ...p, files: p.files.map(f => f.id === fileId ? { ...f, icon: reader.result } : f) } : p);
                    setProjects(updatedProjects); setActiveProject(updatedProjects.find(p => p.id === activeProject.id));
                };
                if (iconFile) reader.readAsDataURL(iconFile);
            };

            // CRUD Tareas
            const handleAddTask = (taskText, taskDate) => {
                if (!activeProject) return;
                handleGlobalAddTask(taskText, taskDate, activeProject.id);
                const updatedProject = { ...activeProject, tasks: [...activeProject.tasks, { id: Date.now(), text: taskText, date: taskDate, completed: false }] };
                setActiveProject(updatedProject);
            };
            const handleToggleTask = (taskId) => {
                handleGlobalToggleTask(taskId);
                if(activeProject) setActiveProject(prev => ({ ...prev, tasks: prev.tasks.map(t => t.id === taskId ? { ...t, completed: !t.completed } : t) }));
            };
            const handleDeleteTask = (taskId) => {
                handleGlobalDeleteTask(taskId);
                if(activeProject) setActiveProject(prev => ({ ...prev, tasks: prev.tasks.filter(t => t.id !== taskId) }));
            };

            return (
                <div className="min-h-screen bg-[#f5f5f7] text-[#1d1d1f] font-sans selection:bg-blue-100 pb-12">
                    {/* Navbar */}
                    <nav className="fixed top-0 w-full z-50 bg-white/70 backdrop-blur-xl border-b border-gray-200/50 transition-all duration-300">
                        <div className="max-w-7xl mx-auto px-6 h-14 flex items-center justify-between">
                            <div className="flex items-center gap-2 cursor-pointer" onClick={handleBackToDashboard}>
                                <div className="w-5 h-5 bg-black rounded text-white flex items-center justify-center font-bold text-xs">P</div>
                                <span className="font-semibold tracking-tight text-sm">Proyectos</span>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="hidden md:flex items-center bg-gray-100/50 rounded-lg px-2 py-1 focus-within:bg-white focus-within:ring-2 ring-blue-500/20 transition-all">
                                    <Search className="w-4 h-4 text-gray-400" />
                                    <input type="text" placeholder="Buscar..." className="bg-transparent border-none text-xs w-48 px-2 py-1 outline-none placeholder:text-gray-400" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} />
                                </div>
                                <div className="flex items-center gap-3 pl-2 pr-1 py-1 rounded-full hover:bg-gray-100 transition-colors cursor-pointer group" onClick={() => setIsProfileModalOpen(true)}>
                                    <span className="text-xs font-medium text-gray-600 group-hover:text-gray-900 hidden sm:block">Hola, {userProfile.name}</span>
                                    <div className="w-8 h-8 rounded-full bg-gray-200 border border-white shadow-sm overflow-hidden relative">
                                        {userProfile.avatar ? <img src={userProfile.avatar} alt="User" className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center bg-gray-300 text-gray-500"><User className="w-4 h-4" /></div>}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </nav>

                    <main className="pt-24 px-6 max-w-7xl mx-auto min-h-screen">
                        {currentView === 'dashboard' && (
                            <div className="animate-fade-in-up">
                                <div className="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
                                    <div>
                                        <h1 className="text-4xl font-bold tracking-tight text-gray-900 mb-1">{dashboardView === 'grid' ? 'Mis Proyectos' : 'Calendario Global'}</h1>
                                        <p className="text-gray-500 font-medium">{dashboardView === 'grid' ? 'Organiza tus ideas y documentos.' : 'Vista general de todas tus tareas.'}</p>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <div className="bg-gray-200/50 p-1 rounded-lg flex items-center">
                                            <button onClick={() => setDashboardView('grid')} className={`px-3 py-1.5 rounded-md text-xs font-semibold flex items-center gap-2 transition-all ${dashboardView === 'grid' ? 'bg-white shadow-sm text-gray-900' : 'text-gray-500 hover:text-gray-700'}`}><LayoutGrid className="w-3.5 h-3.5" /> Proyectos</button>
                                            <button onClick={() => setDashboardView('calendar')} className={`px-3 py-1.5 rounded-md text-xs font-semibold flex items-center gap-2 transition-all ${dashboardView === 'calendar' ? 'bg-white shadow-sm text-gray-900' : 'text-gray-500 hover:text-gray-700'}`}><CalendarDays className="w-3.5 h-3.5" /> Calendario</button>
                                        </div>
                                        {dashboardView === 'grid' && (
                                            <button onClick={() => setIsModalOpen(true)} className="bg-[#0071e3] hover:bg-[#0077ed] text-white px-4 py-2 rounded-full text-xs font-medium transition-all shadow-sm active:scale-95 flex items-center gap-2 h-9"><Plus className="w-3.5 h-3.5" /> Nuevo Proyecto</button>
                                        )}
                                    </div>
                                </div>

                                {dashboardView === 'grid' ? (
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {projects.filter(p => p.title.toLowerCase().includes(searchQuery.toLowerCase())).map((project) => (
                                            <div key={project.id} onClick={() => handleOpenProject(project)} className="group bg-white rounded-[24px] p-6 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-500 cursor-pointer border border-transparent hover:border-gray-100 relative overflow-hidden">
                                                <div className="absolute top-0 right-0 p-6 opacity-0 group-hover:opacity-100 transition-opacity duration-300"><div className="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200"><ArrowLeft className="w-4 h-4 rotate-180 text-gray-600" /></div></div>
                                                <div className={`w-12 h-12 ${project.color} rounded-2xl flex items-center justify-center mb-4 shadow-md text-white overflow-hidden relative bg-cover bg-center`}>{project.icon ? <img src={project.icon} alt={project.title} className="w-full h-full object-cover" /> : <Folder className="w-6 h-6" />}</div>
                                                <h3 className="text-xl font-semibold text-gray-900 mb-1 truncate">{project.title}</h3>
                                                <p className="text-sm text-gray-400 mb-6">{project.category}</p>
                                                <div className="flex items-center justify-between border-t border-gray-100 pt-4">
                                                    <div className="flex gap-4"><span className="text-xs font-medium text-gray-400 flex items-center gap-1"><FileText className="w-3 h-3"/> {project.files.length}</span><span className="text-xs font-medium text-gray-400 flex items-center gap-1"><CheckSquare className="w-3 h-3"/> {project.tasks.filter(t => !t.completed).length}</span></div>
                                                    <div className="flex -space-x-2">{[...Array(3)].map((_, i) => (<div key={i} className="w-6 h-6 rounded-full bg-gray-200 border-2 border-white"></div>))}</div>
                                                </div>
                                            </div>
                                        ))}
                                        <button onClick={() => setIsModalOpen(true)} className="group border-2 border-dashed border-gray-200 rounded-[24px] flex flex-col items-center justify-center p-6 text-gray-400 hover:border-[#0071e3] hover:text-[#0071e3] hover:bg-blue-50/50 transition-all duration-300 min-h-[200px]">
                                            <div className="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mb-3 group-hover:bg-blue-100 transition-colors"><Plus className="w-6 h-6" /></div>
                                            <span className="font-medium text-sm">Crear nuevo espacio</span>
                                        </button>
                                    </div>
                                ) : (
                                    <ProjectCalendar tasks={getAllTasks()} onAddTask={handleGlobalAddTask} onToggleTask={handleGlobalToggleTask} onDeleteTask={handleGlobalDeleteTask} isGlobal={true} projects={projects} />
                                )}
                            </div>
                        )}

                        {currentView === 'project-detail' && activeProject && (
                            <div className="animate-fade-in">
                                <div className="flex items-center justify-between mb-8">
                                    <div className="flex items-center gap-4">
                                        <button onClick={handleBackToDashboard} className="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-sm hover:bg-gray-50 transition-colors text-gray-600"><ArrowLeft className="w-5 h-5" /></button>
                                        <div className="flex items-center gap-4">
                                            <div className={`w-14 h-14 ${activeProject.color} rounded-2xl flex items-center justify-center shadow-md text-white overflow-hidden relative`}>{activeProject.icon ? <img src={activeProject.icon} alt={activeProject.title} className="w-full h-full object-cover" /> : <Folder className="w-7 h-7" />}</div>
                                            <div><h2 className="text-3xl font-bold text-gray-900 tracking-tight">{activeProject.title}</h2><div className="flex items-center gap-2 text-sm text-gray-500"><span className="bg-gray-200 px-2 py-0.5 rounded text-xs font-semibold text-gray-600 uppercase tracking-wide">{activeProject.category}</span></div></div>
                                        </div>
                                    </div>
                                    <button onClick={() => setIsSettingsModalOpen(true)} className="p-2.5 bg-white rounded-full shadow-sm hover:bg-gray-50 transition-colors text-gray-600 relative group"><Settings className="w-5 h-5" /></button>
                                </div>
                                <div className="flex justify-center mb-8">
                                    <div className="bg-gray-200/50 p-1 rounded-full flex gap-1">
                                        <button onClick={() => setActiveTab('files')} className={`px-6 py-2 rounded-full text-sm font-medium transition-all ${activeTab === 'files' ? 'bg-white shadow-sm text-gray-900' : 'text-gray-500 hover:text-gray-700'}`}>Documentos</button>
                                        <button onClick={() => setActiveTab('calendar')} className={`px-6 py-2 rounded-full text-sm font-medium transition-all flex items-center gap-2 ${activeTab === 'calendar' ? 'bg-white shadow-sm text-gray-900' : 'text-gray-500 hover:text-gray-700'}`}>Calendario & Tareas</button>
                                    </div>
                                </div>
                                {activeTab === 'files' ? (
                                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 animate-fade-in">
                                        <div className="lg:col-span-2">
                                            <div className="bg-white rounded-[24px] shadow-sm border border-gray-100 overflow-hidden min-h-[500px]">
                                                <div className="px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50"><h3 className="font-semibold text-gray-700">Documentos</h3><div className="flex gap-2"><button className="p-1.5 hover:bg-gray-200 rounded text-gray-500"><ListIcon className="w-4 h-4"/></button><button className="p-1.5 hover:bg-gray-200 rounded text-gray-500"><GridIcon className="w-4 h-4"/></button></div></div>
                                                <div className="p-2">
                                                    {activeProject.files.length === 0 ? <div className="flex flex-col items-center justify-center h-64 text-gray-400"><Folder className="w-12 h-12 mb-3 text-gray-200" /><p>No hay archivos todavía</p></div> : 
                                                    <table className="w-full text-left border-collapse"><thead><tr className="text-xs text-gray-400 border-b border-gray-50"><th className="px-4 py-3 font-medium">Nombre</th><th className="px-4 py-3 font-medium">Tamaño</th><th className="px-4 py-3 font-medium">Fecha</th><th className="px-4 py-3 font-medium text-right w-16"></th></tr></thead><tbody>{activeProject.files.map((file) => (<FileRow key={file.id} file={file} isEditing={editingFileId === file.id} onEditStart={() => setEditingFileId(file.id)} onRename={handleRenameFile} onChangeIcon={handleChangeFileIcon} onPreview={() => setPreviewFile(file)} />))}</tbody></table>}
                                                </div>
                                            </div>
                                        </div>
                                        <div className="lg:col-span-1"><div className="bg-white rounded-[24px] p-6 shadow-sm border border-gray-100 h-full flex flex-col"><h3 className="font-semibold text-gray-900 mb-4">Añadir Archivos</h3><FileUploader onUpload={handleUploadFile} /><div className="mt-6 pt-6 border-t border-gray-100"><h4 className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">Actividad Reciente</h4><ul className="space-y-4"><li className="flex gap-3 text-sm"><div className="w-2 h-2 rounded-full bg-blue-500 mt-1.5 flex-shrink-0"></div><p className="text-gray-600"><span className="text-gray-900 font-medium">Sistema</span> Proyecto abierto.</p></li></ul></div></div></div>
                                    </div>
                                ) : (
                                    <ProjectCalendar tasks={activeProject.tasks} onAddTask={handleAddTask} onToggleTask={handleToggleTask} onDeleteTask={handleDeleteTask} isGlobal={false} />
                                )}
                            </div>
                        )}
                    </main>

                    {/* Modals */}
                    {isModalOpen && <CreateProjectModal onClose={() => setIsModalOpen(false)} onCreate={handleCreateProject} />}
                    {isSettingsModalOpen && activeProject && <ProjectSettingsModal project={activeProject} onClose={() => setIsSettingsModalOpen(false)} onUpdate={handleUpdateProject} />}
                    {isProfileModalOpen && <ProfileSettingsModal user={userProfile} onClose={() => setIsProfileModalOpen(false)} onUpdate={handleUpdateProfile} />}
                    {previewFile && <FilePreviewModal file={previewFile} onClose={() => setPreviewFile(null)} />}
                </div>
            );
        };

        // --- SUBCOMPONENTES ---

        // Modal de Previsualización (Nuevo Componente)
        const FilePreviewModal = ({ file, onClose }) => {
            const isImage = ['PNG', 'JPG', 'JPEG', 'GIF', 'SVG', 'WEBP'].includes(file.type);
            const isPDF = file.type === 'PDF';
            
            return (
                <div className="fixed inset-0 z-[150] flex items-center justify-center px-4 animate-fade-in">
                    <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={onClose}></div>
                    <div className="relative bg-white/90 backdrop-blur-xl rounded-[20px] shadow-2xl w-full max-w-4xl h-[85vh] flex flex-col border border-white/20 overflow-hidden animate-scale-in">
                         {/* Header */}
                        <div className="flex items-center justify-between px-6 py-4 border-b border-gray-200/50 bg-white/50">
                            <div className="flex items-center gap-3 overflow-hidden">
                                <div className="w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center flex-shrink-0">
                                   {file.icon ? <img src={file.icon} className="w-full h-full object-cover rounded-lg"/> : <FileText className="w-6 h-6 text-gray-500"/>}
                                </div>
                                <div className="min-w-0">
                                    <h3 className="font-semibold text-gray-900 truncate">{file.name}</h3>
                                    <p className="text-xs text-gray-500">{file.size} • {file.type}</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-3">
                                {file.content && (
                                    <a href={file.content} download={file.name} className="p-2 hover:bg-gray-200/50 rounded-full transition-colors text-gray-600" title="Descargar">
                                        <Download className="w-5 h-5"/>
                                    </a>
                                )}
                                <button onClick={onClose} className="p-2 hover:bg-gray-200/50 rounded-full transition-colors text-gray-600">
                                    <XIcon className="w-6 h-6"/>
                                </button>
                            </div>
                        </div>

                        {/* Content */}
                        <div className="flex-1 overflow-auto bg-[#f5f5f7] flex items-center justify-center p-4 relative">
                            {file.content ? (
                                isImage ? (
                                    <img src={file.content} alt={file.name} className="max-w-full max-h-full object-contain shadow-lg rounded-md" />
                                ) : isPDF ? (
                                    <iframe src={file.content} className="w-full h-full rounded-md shadow-sm bg-white" title="PDF Preview"></iframe>
                                ) : (
                                    <div className="text-center">
                                        <div className="w-24 h-24 bg-white rounded-2xl mx-auto flex items-center justify-center shadow-sm mb-4">
                                            <FileText className="w-10 h-10 text-gray-400"/>
                                        </div>
                                        <p className="text-gray-500 font-medium">Previsualización no disponible para este formato.</p>
                                        <p className="text-sm text-gray-400 mt-2 max-w-md mx-auto truncate break-all bg-gray-200/50 p-2 rounded">{file.content.substring(0, 50)}...</p>
                                    </div>
                                )
                            ) : (
                                <div className="text-center">
                                    <div className="w-24 h-24 bg-white rounded-2xl mx-auto flex items-center justify-center shadow-sm mb-4">
                                         <Eye className="w-10 h-10 text-gray-300"/>
                                    </div>
                                    <p className="text-gray-500 font-medium">Archivo simulado</p>
                                    <p className="text-sm text-gray-400 mt-1">Sube un archivo real para verlo aquí.</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const ProjectCalendar = ({ tasks, onAddTask, onToggleTask, onDeleteTask, isGlobal = false, projects = [] }) => {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [selectedDate, setSelectedDate] = useState(new Date());
            const [newTaskText, setNewTaskText] = useState('');
            const [selectedProjectId, setSelectedProjectId] = useState(projects.length > 0 ? projects[0].id : '');
            const [isAddingTask, setIsAddingTask] = useState(false);
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const daysInMonth = getDaysInMonth(year, month);
            const firstDay = getFirstDayOfMonth(year, month);
            const blanks = Array(firstDay).fill(null);
            const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);
            const prevMonth = () => setCurrentDate(new Date(year, month - 1, 1));
            const nextMonth = () => setCurrentDate(new Date(year, month + 1, 1));
            const goToToday = () => { const today = new Date(); setCurrentDate(today); setSelectedDate(today); }
            const handleDateClick = (day) => { setSelectedDate(new Date(year, month, day)); setIsAddingTask(false); };
            const handleAddTaskSubmit = (e) => {
                e.preventDefault();
                if(newTaskText.trim()) {
                    const dateStr = selectedDate.toISOString().split('T')[0];
                    isGlobal ? onAddTask(newTaskText, dateStr, selectedProjectId) : onAddTask(newTaskText, dateStr);
                    setNewTaskText(''); setIsAddingTask(false);
                }
            };
            const selectedDateStr = selectedDate.toISOString().split('T')[0];
            const daysTasks = tasks.filter(t => t.date === selectedDateStr);

            return (
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 animate-fade-in">
                    <div className="lg:col-span-2"><div className="bg-white rounded-[24px] shadow-sm border border-gray-100 p-6 min-h-[500px]"><div className="flex items-center justify-between mb-6"><div><h2 className="text-2xl font-bold text-gray-900">{months[month]} <span className="text-gray-400 font-medium">{year}</span></h2></div><div className="flex items-center gap-2"><button onClick={goToToday} className="text-sm font-medium text-blue-600 hover:bg-blue-50 px-3 py-1 rounded-md transition-colors mr-2">Hoy</button><button onClick={prevMonth} className="p-2 hover:bg-gray-100 rounded-full transition-colors"><ChevronLeft className="w-5 h-5 text-gray-600"/></button><button onClick={nextMonth} className="p-2 hover:bg-gray-100 rounded-full transition-colors"><ChevronRight className="w-5 h-5 text-gray-600"/></button></div></div><div className="grid grid-cols-7 mb-2">{daysOfWeek.map(d => <div key={d} className="text-center text-xs font-semibold text-gray-400 uppercase tracking-wide py-2">{d}</div>)}</div><div className="grid grid-cols-7 gap-2">{blanks.map((_, i) => <div key={`blank-${i}`} className="h-24"></div>)}{days.map(day => {const dateStr = new Date(year, month, day).toISOString().split('T')[0]; const dayTasks = tasks.filter(t => t.date === dateStr); const isSelected = selectedDate.getDate() === day && selectedDate.getMonth() === month && selectedDate.getFullYear() === year; const isToday = new Date().getDate() === day && new Date().getMonth() === month && new Date().getFullYear() === year; return (<div key={day} onClick={() => handleDateClick(day)} className={`h-24 rounded-xl p-2 cursor-pointer transition-all border border-transparent flex flex-col items-start gap-1 ${isSelected ? 'bg-blue-50 border-blue-200 shadow-inner' : 'hover:bg-gray-50 hover:border-gray-100'}`}><span className={`w-7 h-7 flex items-center justify-center rounded-full text-sm font-medium ${isToday ? 'bg-blue-500 text-white' : isSelected ? 'text-blue-600' : 'text-gray-700'}`}>{day}</span><div className="flex flex-wrap gap-1 content-start w-full">{dayTasks.slice(0, 4).map((task, i) => (<div key={i} className={`w-1.5 h-1.5 rounded-full ${isGlobal && task.projectColor ? task.projectColor.replace('bg-', 'bg-') : (task.completed ? 'bg-green-400' : 'bg-orange-400')}`} title={task.text}/>))}</div></div>);})}</div></div></div>
                    <div className="lg:col-span-1"><div className="bg-white rounded-[24px] shadow-sm border border-gray-100 h-full flex flex-col overflow-hidden"><div className="p-6 border-b border-gray-100 bg-gray-50/50"><h3 className="font-semibold text-gray-900 text-lg flex items-center gap-2"><CalendarIcon className="w-5 h-5 text-gray-500" />{selectedDate.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' })}</h3><p className="text-sm text-gray-500 mt-1 pl-7">{daysTasks.length} {daysTasks.length === 1 ? 'Tarea' : 'Tareas'} para hoy</p></div><div className="flex-1 p-6 overflow-y-auto">{daysTasks.length === 0 && !isAddingTask ? (<div className="flex flex-col items-center justify-center h-full text-gray-400 text-center"><Clock className="w-12 h-12 mb-3 text-gray-200" /><p>No tienes tareas para este día.</p><button onClick={() => setIsAddingTask(true)} className="mt-4 text-blue-500 text-sm font-medium hover:underline">Añadir una tarea</button></div>) : (<ul className="space-y-3">{daysTasks.map(task => (<li key={task.id} className="group flex flex-col p-3 rounded-xl hover:bg-gray-50 transition-colors border border-transparent hover:border-gray-100 relative"><div className="flex items-start gap-3"><button onClick={() => onToggleTask(task.id)} className={`mt-0.5 flex-shrink-0 w-5 h-5 rounded border transition-colors flex items-center justify-center ${task.completed ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300 text-transparent hover:border-blue-400'}`}><Check className="w-3.5 h-3.5" /></button><div className="flex-1"><span className={`text-sm block ${task.completed ? 'text-gray-400 line-through' : 'text-gray-700'}`}>{task.text}</span>{isGlobal && task.projectTitle && (<span className={`text-[10px] font-semibold uppercase tracking-wide mt-1 block ${task.projectTextColor || 'text-gray-400'}`}>{task.projectTitle}</span>)}</div><button onClick={() => onDeleteTask(task.id)} className="opacity-0 group-hover:opacity-100 text-red-400 hover:text-red-600 transition-opacity p-1"><Trash2 className="w-4 h-4" /></button></div></li>))}</ul>)}</div><div className="p-4 border-t border-gray-100 bg-white">{isAddingTask ? (<form onSubmit={handleAddTaskSubmit} className="flex flex-col gap-2"><input autoFocus type="text" placeholder="Escribe la tarea..." className="w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all" value={newTaskText} onChange={(e) => setNewTaskText(e.target.value)} />{isGlobal && (<select className="w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-xs focus:outline-none text-gray-600" value={selectedProjectId} onChange={(e) => setSelectedProjectId(e.target.value)}>{projects.map(p => (<option key={p.id} value={p.id}>{p.title}</option>))}</select>)}<div className="flex justify-end gap-2 mt-1"><button type="button" onClick={() => setIsAddingTask(false)} className="px-3 py-1.5 text-xs font-medium text-gray-500 hover:bg-gray-100 rounded-lg">Cancelar</button><button type="submit" disabled={!newTaskText.trim()} className="px-3 py-1.5 text-xs font-medium bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50">Guardar</button></div></form>) : (<button onClick={() => setIsAddingTask(true)} className="w-full py-2.5 rounded-xl border border-dashed border-gray-300 text-gray-500 text-sm font-medium hover:border-blue-400 hover:text-blue-500 hover:bg-blue-50 transition-all flex items-center justify-center gap-2"><Plus className="w-4 h-4" /> Nueva Tarea</button>)}</div></div></div>
                </div>
            );
        };

        const FileRow = ({ file, isEditing, onEditStart, onRename, onChangeIcon, onPreview }) => {
            const [menuOpen, setMenuOpen] = useState(false);
            const [tempName, setTempName] = useState(file.name);
            const menuRef = useRef(null);
            const fileInputRef = useRef(null);
            useEffect(() => { const handleClickOutside = (event) => { if (menuRef.current && !menuRef.current.contains(event.target)) setMenuOpen(false); }; document.addEventListener('mousedown', handleClickOutside); return () => document.removeEventListener('mousedown', handleClickOutside); }, []);
            const handleRenameSubmit = () => { if (tempName.trim() && tempName !== file.name) onRename(file.id, tempName); else { setTempName(file.name); onRename(file.id, file.name); } };
            const handleIconChange = (e) => { if (e.target.files.length > 0) onChangeIcon(file.id, e.target.files[0]); setMenuOpen(false); };
            return (
                <tr className="group hover:bg-blue-50/30 transition-colors rounded-lg text-sm text-gray-600 relative">
                    <td className="px-4 py-3 flex items-center gap-3 cursor-pointer" onClick={() => !isEditing && onPreview()}>
                        <div className="w-8 h-8 rounded bg-orange-100 text-orange-600 flex items-center justify-center overflow-hidden relative flex-shrink-0 shadow-sm border border-orange-200/50">
                            {file.icon ? <img src={file.icon} alt={file.name} className="w-full h-full object-cover" /> : <FileText className="w-4 h-4" />}
                        </div>
                        {isEditing ? 
                            <input autoFocus type="text" value={tempName} onChange={(e) => setTempName(e.target.value)} onBlur={handleRenameSubmit} onKeyDown={(e) => {if(e.key==='Enter')handleRenameSubmit(); if(e.key==='Escape'){setTempName(file.name);onRename(file.id, file.name);}}} className="font-medium text-gray-900 bg-white border-2 border-blue-500 rounded px-2 py-1 outline-none w-full shadow-sm" onClick={(e) => e.stopPropagation()} /> 
                            : <span className="font-medium text-gray-900 truncate max-w-[200px] hover:text-blue-600 transition-colors">{file.name}</span>
                        }
                    </td>
                    <td className="px-4 py-3 text-xs">{file.size}</td>
                    <td className="px-4 py-3 text-xs">{file.date}</td>
                    <td className="px-4 py-3 text-right relative">
                        <button onClick={(e) => { e.stopPropagation(); setMenuOpen(!menuOpen); }} className="opacity-0 group-hover:opacity-100 p-1 hover:bg-gray-200 rounded transition-all focus:opacity-100"><MoreHorizontal className="w-4 h-4" /></button>
                        {menuOpen && <div ref={menuRef} className="absolute right-8 top-0 bg-white rounded-xl shadow-xl border border-gray-100 z-10 w-48 overflow-hidden animate-scale-up origin-top-right"><div className="p-1"><button onClick={() => { setMenuOpen(false); onEditStart(); }} className="w-full text-left px-3 py-2 hover:bg-blue-50 hover:text-blue-600 rounded-lg text-xs font-medium flex items-center gap-2"><Edit2 className="w-3.5 h-3.5" /> Renombrar</button><button onClick={() => fileInputRef.current.click()} className="w-full text-left px-3 py-2 hover:bg-blue-50 hover:text-blue-600 rounded-lg text-xs font-medium flex items-center gap-2"><ImageIcon className="w-3.5 h-3.5" /> Cambiar Icono<input type="file" ref={fileInputRef} className="hidden" accept="image/*" onChange={handleIconChange} /></button><div className="h-px bg-gray-100 my-1"></div><button className="w-full text-left px-3 py-2 hover:bg-red-50 hover:text-red-600 rounded-lg text-xs font-medium flex items-center gap-2 text-red-500"><Trash2 className="w-3.5 h-3.5" /> Eliminar</button></div></div>}
                    </td>
                </tr>
            );
        };

        const FileUploader = ({ onUpload }) => {
            const [isDragging, setIsDragging] = useState(false);
            const fileInputRef = useRef(null);
            return (<div className={`flex-1 border-2 border-dashed rounded-2xl flex flex-col items-center justify-center p-6 text-center transition-all duration-300 cursor-pointer ${isDragging ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-blue-300 hover:bg-gray-50'}`} onDragOver={(e)=>{e.preventDefault();setIsDragging(true)}} onDragLeave={()=>setIsDragging(false)} onDrop={(e)=>{e.preventDefault();setIsDragging(false);if(e.dataTransfer.files.length>0)onUpload(e.dataTransfer.files[0])}} onClick={()=>fileInputRef.current.click()}><input type="file" ref={fileInputRef} className="hidden" onChange={(e) => e.target.files.length > 0 && onUpload(e.target.files[0])} /><div className={`w-14 h-14 rounded-full flex items-center justify-center mb-4 transition-colors ${isDragging ? 'bg-blue-100 text-blue-600' : 'bg-gray-100 text-gray-400'}`}><UploadCloud className="w-7 h-7" /></div><p className="font-semibold text-gray-700">Arrastra archivos aquí</p><p className="text-xs text-gray-400 mt-1">o haz clic para explorar</p></div>);
        };

        const CreateProjectModal = ({ onClose, onCreate }) => {
            const [title, setTitle] = useState(''); const [category, setCategory] = useState('General'); const [icon, setIcon] = useState(null); const fileInputRef = useRef(null);
            const handleIconSelect = (e) => { if(e.target.files.length > 0) { const reader = new FileReader(); reader.onloadend = () => setIcon(reader.result); reader.readAsDataURL(e.target.files[0]); } };
            return (<div className="fixed inset-0 z-[100] flex items-center justify-center px-4"><div className="absolute inset-0 bg-black/20 backdrop-blur-sm transition-opacity" onClick={onClose}></div><div className="bg-white rounded-[24px] shadow-2xl w-full max-w-md p-8 relative z-10 animate-scale-up"><button onClick={onClose} className="absolute top-6 right-6 text-gray-400 hover:text-gray-800"><XIcon className="w-5 h-5" /></button><h2 className="text-2xl font-bold text-gray-900 mb-6">Nuevo Proyecto</h2><form onSubmit={(e) => {e.preventDefault(); if(title.trim()) onCreate(title, category, icon);}} className="space-y-5"><div className="flex justify-center mb-6"><div onClick={() => fileInputRef.current.click()} className="w-24 h-24 rounded-2xl bg-gray-100 border-2 border-dashed border-gray-300 hover:border-blue-400 cursor-pointer flex items-center justify-center overflow-hidden relative group"><input type="file" ref={fileInputRef} className="hidden" accept="image/*" onChange={handleIconSelect} />{icon ? <img src={icon} alt="Preview" className="w-full h-full object-cover" /> : <div className="text-center text-gray-400"><ImageIcon className="w-8 h-8 mx-auto mb-1" /><span className="text-[10px]">Subir Icono</span></div>}<div className="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"><Edit2 className="w-5 h-5 text-white" /></div></div></div><div><label className="block text-sm font-medium text-gray-600 mb-2">Nombre</label><input autoFocus type="text" value={title} onChange={(e) => setTitle(e.target.value)} className="w-full px-4 py-3 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all text-gray-900" placeholder="Ej. Campaña Navidad" /></div><div><label className="block text-sm font-medium text-gray-600 mb-2">Categoría</label><div className="grid grid-cols-3 gap-2">{['Marketing', 'Desarrollo', 'Finanzas'].map(cat => (<button key={cat} type="button" onClick={() => setCategory(cat)} className={`px-3 py-2 rounded-lg text-sm font-medium transition-all ${category === cat ? 'bg-black text-white shadow-md' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}`}>{cat}</button>))}</div></div><div className="pt-4 flex justify-end gap-3"><button type="button" onClick={onClose} className="px-5 py-2.5 rounded-full text-sm font-medium text-gray-600 hover:bg-gray-100 transition-colors">Cancelar</button><button type="submit" disabled={!title} className="px-6 py-2.5 rounded-full text-sm font-medium bg-[#0071e3] text-white shadow-lg shadow-blue-500/30 hover:bg-[#0077ed] active:scale-95 transition-all disabled:opacity-50">Crear</button></div></form></div></div>);
        };

        const ProjectSettingsModal = ({ project, onClose, onUpdate }) => {
            const [title, setTitle] = useState(project.title); const [icon, setIcon] = useState(project.icon); const fileInputRef = useRef(null);
            const handleIconSelect = (e) => { if(e.target.files.length > 0) { const reader = new FileReader(); reader.onloadend = () => setIcon(reader.result); reader.readAsDataURL(e.target.files[0]); } };
            return (<div className="fixed inset-0 z-[100] flex items-center justify-center px-4"><div className="absolute inset-0 bg-black/20 backdrop-blur-sm transition-opacity" onClick={onClose}></div><div className="bg-white rounded-[24px] shadow-2xl w-full max-w-md p-8 relative z-10 animate-scale-up"><button onClick={onClose} className="absolute top-6 right-6 text-gray-400 hover:text-gray-800"><XIcon className="w-5 h-5" /></button><h2 className="text-2xl font-bold text-gray-900 mb-6">Ajustes de Proyecto</h2><form onSubmit={(e) => { e.preventDefault(); if(title.trim()) onUpdate(project.id, title, icon); }} className="space-y-5"><div className="flex justify-center mb-6"><div onClick={() => fileInputRef.current.click()} className="w-24 h-24 rounded-2xl bg-gray-100 border-2 border-dashed border-gray-300 hover:border-blue-400 cursor-pointer flex items-center justify-center overflow-hidden relative group"><input type="file" ref={fileInputRef} className="hidden" accept="image/*" onChange={handleIconSelect} />{icon ? <img src={icon} alt="Preview" className="w-full h-full object-cover" /> : <Folder className="w-10 h-10 text-gray-400" />}<div className="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"><Edit2 className="w-5 h-5 text-white" /></div></div></div><div><label className="block text-sm font-medium text-gray-600 mb-2">Renombrar Proyecto</label><input type="text" value={title} onChange={(e) => setTitle(e.target.value)} className="w-full px-4 py-3 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all text-gray-900" /></div><div className="pt-4 flex justify-end gap-3"><button type="button" onClick={onClose} className="px-5 py-2.5 rounded-full text-sm font-medium text-gray-600 hover:bg-gray-100 transition-colors">Cancelar</button><button type="submit" disabled={!title} className="px-6 py-2.5 rounded-full text-sm font-medium bg-[#0071e3] text-white shadow-lg shadow-blue-500/30 hover:bg-[#0077ed] active:scale-95 transition-all disabled:opacity-50">Guardar</button></div></form></div></div>);
        };

        const ProfileSettingsModal = ({ user, onClose, onUpdate }) => {
            const [name, setName] = useState(user.name); const [avatar, setAvatar] = useState(user.avatar); const fileInputRef = useRef(null);
            const handleAvatarSelect = (e) => { if(e.target.files.length > 0) { const reader = new FileReader(); reader.onloadend = () => setAvatar(reader.result); reader.readAsDataURL(e.target.files[0]); } };
            return (<div className="fixed inset-0 z-[100] flex items-center justify-center px-4"><div className="absolute inset-0 bg-black/20 backdrop-blur-sm transition-opacity" onClick={onClose}></div><div className="bg-white rounded-[24px] shadow-2xl w-full max-w-md p-8 relative z-10 animate-scale-up"><button onClick={onClose} className="absolute top-6 right-6 text-gray-400 hover:text-gray-800"><XIcon className="w-5 h-5" /></button><h2 className="text-2xl font-bold text-gray-900 mb-6">Tu Perfil</h2><form onSubmit={(e) => {e.preventDefault(); if(name.trim()) onUpdate(name, avatar);}} className="space-y-5"><div className="flex flex-col items-center justify-center mb-6"><div onClick={() => fileInputRef.current.click()} className="w-28 h-28 rounded-full bg-gray-100 border-4 border-white shadow-lg cursor-pointer flex items-center justify-center overflow-hidden relative group"><input type="file" ref={fileInputRef} className="hidden" accept="image/*" onChange={handleAvatarSelect} />{avatar ? <img src={avatar} alt="Avatar Preview" className="w-full h-full object-cover" /> : <User className="w-10 h-10 text-gray-400" />}<div className="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"><Edit2 className="w-6 h-6 text-white" /></div></div><p className="text-xs text-gray-500 mt-3">Haz clic para cambiar tu foto</p></div><div><label className="block text-sm font-medium text-gray-600 mb-2">Tu Nombre</label><input autoFocus type="text" value={name} onChange={(e) => setName(e.target.value)} className="w-full px-4 py-3 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all text-gray-900 text-center text-lg font-medium" placeholder="Ej. Juan Pérez" /></div><div className="pt-4 flex justify-end gap-3"><button type="button" onClick={onClose} className="px-5 py-2.5 rounded-full text-sm font-medium text-gray-600 hover:bg-gray-100 transition-colors">Cancelar</button><button type="submit" disabled={!name} className="px-6 py-2.5 rounded-full text-sm font-medium bg-[#0071e3] text-white shadow-lg shadow-blue-500/30 hover:bg-[#0077ed] active:scale-95 transition-all disabled:opacity-50">Guardar Perfil</button></div></form></div></div>);
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>